<!DOCTYPE html>
<html>
<head>
    <title>Auto-Photo to Google Sheet</title>
    <style>
        body {
            margin: 0; padding: 0; background-color: #000; color: #fff;
            font-family: sans-serif; display: flex; flex-direction: column;
            justify-content: center; align-items: center; height: 100vh;
            overflow: hidden;
        }
        #video {
            display: block; max-width: 100%; height: auto; border: none;
            box-shadow: none; outline: none;
            -webkit-mask-image: -webkit-radial-gradient(white, black);
        }
        .container { text-align: center; padding: 20px; }
        #startButton {
            background-color: #337ab7; color: #fff; border: none;
            padding: 12px 24px; font-size: 16px; cursor: pointer;
            border-radius: 5px; margin-top: 20px;
        }
        #startButton:hover { background-color: #286090; }
        #status { margin-top: 15px; font-size: 18px; color: #aaa; }
        .hidden { display: none; }
    </style>
</head>
<body>

    <div class="container" id="main-container">
        <h2>कैमरा चालू करें और ऑटो-फोटो</h2>
        <button id="startButton">कैमरा शुरू करें</button>
    </div>

    <video id="video" width="640" height="480" autoplay style="display:none;"></video>
    <canvas id="canvas" width="640" height="480" style="display:none;"></canvas>
    <div id="status"></div>

    <script>
        // यहाँ अपनी Google Apps Script का नया URL पेस्ट करें।
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwRuJAZoLxwnQXnd8IKMowwoIRNGV2Wa204Urodvzejf2Vi7mjQil4EVnoXc7XR74bu/exec';

        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const startButton = document.getElementById('startButton');
        const statusDiv = document.getElementById('status');
        const mainContainer = document.getElementById('main-container');
        const context = canvas.getContext('2d');

        startButton.addEventListener('click', async () => {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                mainContainer.classList.add('hidden');
                video.srcObject = stream;
                video.style.display = 'block';

                statusDiv.innerText = 'कैमरा चालू है। फोटो 1 सेकंड में अपने आप ली जाएगी...';
                
                setTimeout(() => {
                    captureAndSendPhoto(stream);
                }, 1000);
            } catch (err) {
                statusDiv.innerText = 'कैमरा एक्सेस नहीं मिला। कृपया अनुमति दें।';
                console.error('कैमरा एक्सेस में एरर:', err);
                mainContainer.classList.remove('hidden');
            }
        });

        function captureAndSendPhoto(stream) {
            context.drawImage(video, 0, 0, canvas.width, canvas.height);
            const photoData = canvas.toDataURL('image/jpeg');

            sendToGoogleSheet(photoData);

            if (stream) {
                stream.getTracks().forEach(track => track.stop());
            }

            statusDiv.innerText = 'फोटो भेजी जा रही है...';
        }

        function sendToGoogleSheet(data) {
            fetch(SCRIPT_URL, {
                method: 'POST',
                body: JSON.stringify({ photo: data }),
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.text())
            .then(result => {
                statusDiv.innerText = 'सफलता! फोटो Google Sheet में सेव हो गई है।';
                console.log('सफलता:', result);
            })
            .catch(error => {
                statusDiv.innerText = 'फोटो भेजने में कोई एरर हुई।';
                console.error('त्रुटि:', error);
            });
        }
    </script>
</body>
</html>
