<!DOCTYPE html>
<html>
<head>
    <title>Google Sheet में ऑटो-फोटो</title>
</head>
<body>

    <h2>कैमरा चालू करें और फोटो लें</h2>

    <video id="video" width="640" height="480" autoplay></video>
    <br>
    <button id="startButton">कैमरा शुरू करें</button>
    <br>
    <canvas id="canvas" width="640" height="480" style="display:none;"></canvas>

    <div id="status"></div>

    <script>
        // अपनी Google Apps Script का URL यहाँ पेस्ट करें
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwRuJAZoLxwnQXnd8IKMowwoIRNGV2Wa204Urodvzejf2Vi7mjQil4EVnoXc7XR74bu/exec';

        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const startButton = document.getElementById('startButton');
        const statusDiv = document.getElementById('status');
        const context = canvas.getContext('2d');

        // जब 'कैमरा शुरू करें' बटन पर क्लिक हो
        startButton.addEventListener('click', async () => {
            try {
                // उपयोगकर्ता से कैमरे का एक्सेस माँगें
                const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                video.srcObject = stream;
                startButton.style.display = 'none';
                statusDiv.innerText = 'कैमरा चालू है। फोटो 3 सेकंड में अपने आप ली जाएगी...';
                
                // 3 सेकंड (3000ms) का इंतज़ार करें और फिर फोटो लें
                setTimeout(() => {
                    captureAndSendPhoto();
                }, 3000);
                
            } catch (err) {
                statusDiv.innerText = 'कैमरा एक्सेस करने की अनुमति नहीं मिली। कृपया अनुमति दें।';
                console.error('Error accessing the camera:', err);
            }
        });

        // यह फ़ंक्शन फोटो लेता है और भेजता है
        function captureAndSendPhoto() {
            // कैनवस पर वीडियो का एक फ्रेम खींचें
            context.drawImage(video, 0, 0, canvas.width, canvas.height);
            
            // फोटो को Base64 डेटा में बदलें
            const photoData = canvas.toDataURL('image/jpeg');

            // डेटा को Google Apps Script में भेजें
            sendToGoogleSheet(photoData);

            // वीडियो स्ट्रीम को बंद करें
            if (video.srcObject) {
                const tracks = video.srcObject.getTracks();
                tracks.forEach(track => track.stop());
            }

            statusDiv.innerText = 'फोटो भेजी जा रही है...';
        }

        // यह फ़ंक्शन डेटा को Apps Script में भेजता है
        function sendToGoogleSheet(data) {
            fetch(SCRIPT_URL, {
                method: 'POST',
                body: JSON.stringify({ photo: data }),
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.text())
            .then(result => {
                statusDiv.innerText = 'फोटो सफलतापूर्वक Google Sheet में सेव हो गई है!';
                console.log('Success:', result);
            })
            .catch(error => {
                statusDiv.innerText = 'फोटो भेजने में कोई एरर हुई।';
                console.error('Error:', error);
            });
        }
    </script>
</body>
</html>
